<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Blossom & Blade — Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles/chat.css" />
  <style>
    /* Minimal hardening so this file works even if chat.css is older */
    body{margin:0;background:#0b0b0f;color:#f6f7fb;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{padding:22px 16px;text-align:center;font-weight:900;font-size:clamp(20px,3.4vw,38px)}
    .adult-badge{position:fixed;right:18px;top:12px;background:#222;border:1px solid #ffffff22;border-radius:999px;padding:8px 12px;font-weight:800;opacity:.9}
    .chat-shell{width:min(1100px,94vw);margin:0 auto 22px}
    .chat-panel{position:relative;background:rgba(0,0,0,.35);border:1px solid #ffffff22;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px}
    #chat-log{min-height:380px;max-height:62vh;overflow:auto;padding:6px}
    .input-row{display:flex;gap:12px;margin:16px 0 4px}
    #chat-input{flex:1;border-radius:14px;border:1px solid #ffffff22;background:#0e1118;color:#fff;padding:16px;font-size:16px}
    #send-btn{background:#ff2f86;border:none;color:#111;font-weight:900;border-radius:14px;padding:0 22px;font-size:16px;min-width:96px}
    /* Portrait box */
    #bb-portrait{
      position:absolute; right:22px; top:22px; z-index:30;
      width:150px; height:200px; border-radius:16px; overflow:hidden;
      border:1px solid #ffffff22; box-shadow:0 10px 30px rgba(0,0,0,.45);
      background:#0e1118aa; backdrop-filter: blur(6px);
    }
    #bb-portrait img{width:100%;height:100%;object-fit:cover;display:block}
    @media (max-width: 640px){ #bb-portrait{ width:120px;height:160px; right:12px; top:12px; } }
  </style>
</head>
<body>
  <div class="adult-badge">Adults 18+ only</div>
  <header>Blossom & Blade — Chat</header>

  <main class="chat-shell">
    <section class="chat-panel">
      <!-- Mini portrait (new) -->
      <div id="bb-portrait" aria-hidden="true">
        <img id="bb-portrait-img" alt="Character portrait" draggable="false">
      </div>

      <!-- Chat log (your existing chat.js should target this) -->
      <div id="chat-log" aria-live="polite" aria-relevant="additions"></div>

      <!-- Input row (ids match common wiring in your chat.js) -->
      <div class="input-row">
        <input id="chat-input" type="text" placeholder="Say hi…" autocomplete="off" />
        <button id="send-btn" type="button">Send</button>
      </div>
    </section>
  </main>

  <!-- Your existing logic -->
  <script src="/scripts/chat.js"></script>

  <!-- Portrait loader (safe, standalone) -->
  <script>
  (function(){
    // Leave your backgrounds alone; just figure out which guy to show here
    const q = new URLSearchParams(location.search);
    const man = (q.get('man') || 'dylan').toLowerCase();

    // Prefer the “on” card, then “off” card, then old jpgs
    const srcs = [
      `/images/characters/${man}/${man}-card-on.webp`,
      `/images/characters/${man}/${man}-card-off.webp`,
      `/images/characters/${man}/${man}_card.jpg`,
      `/images/images/characters/${man}/${man}_card.jpg`
    ];

    const img = document.getElementById('bb-portrait-img');
    let i = 0;
    function tryNext(){ if (i < srcs.length) img.src = srcs[i++]; }
    img.addEventListener('error', tryNext);
    tryNext();
  })();
  </script>
</body>
</html>
