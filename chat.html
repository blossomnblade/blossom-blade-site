<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blossom & Blade — Chat</title>

  <!-- keep your global css; this page also has tiny inline safety styles -->
  <link rel="stylesheet" href="styles/chat.css">

  <style>
    /* Minimal layout so this page works even if chat.css is borked */
    body{margin:0;background:#0b0d11;color:#e9eef9;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    header{padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.08)}
    header h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.3px}
    main.chat-wrap{display:grid;grid-template-columns:1fr 360px;gap:18px;max-width:1200px;margin:0 auto;padding:18px}
    @media (max-width: 900px){ main.chat-wrap{grid-template-columns:1fr} aside.chat-right{order:-1} }
    .messages-scroll{height:70vh;min-height:420px;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;background:#10131a;overflow:auto}
    ul#messages{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
    .msg{display:flex}
    .msg.user{justify-content:flex-end}
    .bubble{max-width:80%;padding:10px 12px;border-radius:14px;line-height:1.4;box-shadow:0 8px 22px rgba(0,0,0,.35)}
    .msg.user .bubble{background:#2b3050;color:#fff;border-top-right-radius:6px}
    .msg.assistant .bubble{background:#151a24;color:#f2f6ff;border-top-left-radius:6px}
    form.chat-form{display:flex;gap:8px;margin-top:12px}
    #chat-input{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f1218;color:#fff}
    #send-btn{padding:12px 16px;border-radius:12px;border:0;background:#ff2d6f;color:#fff;font-weight:800;cursor:pointer}
    aside.chat-right{border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;background:#10131a}
    .portrait{line-height:0}
    .portrait img{display:block;width:100%;height:auto;border-radius:10px}
  </style>
</head>
<body>
  <header>
    <h1>BnB — Chat — <span id="chatName">…</span></h1>
  </header>

  <main class="chat-wrap">
    <section class="chat-left">
      <div class="messages-scroll">
        <ul id="messages" class="messages"></ul>
      </div>

      <form id="chat-form" class="chat-form" autocomplete="off">
        <input id="chat-input" type="text" placeholder="Say hi…" />
        <button id="send-btn" type="submit">Send</button>
      </form>
    </section>

    <aside class="chat-right">
      <figure id="portrait" class="portrait">
        <img id="portraitImg" alt="">
      </figure>
    </aside>
  </main>

  <!-- Chat logic (prevents reload, saves history, has a local fallback reply) -->
  <script src="scripts/chat.js" defer></script>

  <!-- Age gate + footer + banned-words strikes (already added earlier) -->
  <script src="scripts/consent.js" defer></script>

  <!-- tiny cleanup to remove any stray filename text under the portrait -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const p = document.querySelector('#portrait');
      if (!p) return;
      [...p.childNodes].forEach(n => {
        if (n.nodeType === 3 && /\.(webp|jpe?g|png|gif)$/i.test((n.textContent||'').trim())) n.remove();
      });
      p.querySelectorAll('small, figcaption, a, span, div').forEach(el=>{
        if (/\.(webp|jpe?g|png|gif)$/i.test((el.textContent||'').trim())) el.remove();
      });
    });
  </script>
<script src="scripts/chat.js" defer></script>
</body>
</html>
