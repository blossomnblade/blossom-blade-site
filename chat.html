<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Chat · Blossom & Blade</title>
<meta http-equiv="Cache-Control" content="no-store"/>

<style>
  :root{
    --ink:#eef3ff; --ink-d:#c7d0e4;
    --panel: rgba(12,14,20,.42);            /* translucent container */
    --bubble: rgba(16,18,26,.78);            /* him */
    --bubble-me: rgba(60,22,60,.78);         /* her */
    --ring: rgba(190,220,255,.20);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial;
    background:#0a0d12 center / cover no-repeat fixed;       /* swapped per guy below */
  }
  body::before{content:"";position:fixed;inset:0;pointer-events:none;
    background:radial-gradient(1200px 640px at 50% -10%, rgba(255,255,255,.05), transparent 60%),
               radial-gradient(1100px 700px at 50% 110%, rgba(0,0,0,.38), rgba(0,0,0,.68) 70%);}
  header{display:flex;gap:12px;align-items:center;padding:14px 18px;font-weight:700}
  .bar{height:6px;margin:0 18px;border-radius:6px;background:linear-gradient(90deg,#e8619c,#b66ad5 40%,#7ed0ff)}
  .standards{position:sticky;top:0;text-align:right;padding:6px 18px 0;color:var(--ink-d);font-size:12px}
  .wrap{max-width:1100px;margin:10px auto 44px;padding:0 18px}
  .panel{
    display:flex;flex-direction:column;min-height:560px;
    background:var(--panel);border:1px solid var(--ring);border-radius:18px;
    box-shadow:0 24px 60px rgba(0,0,0,.45);backdrop-filter:blur(4px);padding:18px;
  }
  #log{flex:1;overflow-y:auto;padding-right:4px}
  .row{display:flex;margin:14px 0}.row.me{justify-content:flex-end}
  .bubble{
    padding:12px 14px;max-width:min(720px,90%);border-radius:16px;background:var(--bubble);
    border:1px solid rgba(255,255,255,.08);box-shadow:0 6px 18px rgba(0,0,0,.28);
    line-height:1.45;color:#fff;text-shadow:0 1px 0 rgba(0,0,0,.45)
  }
  .row.me .bubble{background:var(--bubble-me);border-color:rgba(255,180,250,.18)}
  .bubble strong{font-weight:800}
  .composer{display:flex;gap:10px;margin-top:12px;background:rgba(8,10,14,.55);
    border:1px solid var(--ring);border-radius:14px;padding:10px 10px 10px 14px;backdrop-filter:blur(3px)}
  #input{flex:1;background:transparent;border:0;outline:0;color:var(--ink);font:inherit;font-size:16px}
  #input::placeholder{color:rgba(230,235,255,.72)}
  .send{background:#2a2f3f;color:#fff;border:0;border-radius:12px;padding:10px 16px;font-weight:800;cursor:pointer;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.06),0 6px 16px rgba(0,0,0,.35)}
  .send:hover{filter:brightness(1.08)}
  .note{color:var(--ink-d);font-size:12px;text-align:center;margin-top:8px}
</style>
</head>
<body>
  <header>Blossom & Blade · <strong id="gName">…</strong></header>
  <div class="bar"></div>
  <div class="standards">PG-13 by default. We follow your lead, within Community Standards.</div>

  <div class="wrap">
    <div class="panel">
      <div id="log"></div>
      <form id="composer" class="composer">
        <input id="input" autocomplete="off" placeholder="Say hi…"/>
        <button class="send" id="send" type="submit">Send</button>
      </form>
    </div>
    <div class="note">Site stays PG-13. We follow your lead, but within Community Standards.</div>
  </div>

  <!-- ====== PERSONAS + ENGINE ====== -->
  <script>
    // helpers
    const pick=(arr,avoid)=>{ if(!arr?.length) return "";
      if(arr.length===1) return arr[0];
      let x; for(let i=0;i<8;i++){ x=arr[Math.floor(Math.random()*arr.length)]; if(x!==avoid) break; }
      return x;
    };
    const escapeHtml=s=>s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    const getParam=(k,d='')=>{const u=new URL(location.href);return u.searchParams.get(k)||d;};

    // image paths already uploaded
    const BG={
      alexander:"images/bg_alexander_boardroom.jpg",
      dylan:"images/dylan-garage.jpg",
      jesse:"images/jesse_bg.jpg",
      grayson:"images/grayson-bg.jpg",
      silas:"images/bg_silas_stage.jpg",
      blade:"images/blade-woods.jpg"
    };

    // personas with custom opener pools (per your list)
    const GUYS={
      alexander:{id:"alexander",name:"Alexander Jackson",bg:BG.alexander,
        petDefault:()=>pick(["love","sweetheart","gorgeous","angel"]),
        nicknames:{books:"little strategist",music:"smooth operator",coffee:"caffeine queen",city:"skyline girl"},
        jealous:n=>`Should I be jealous, ${n||'love'}—or just win you back properly?`,
        opens:[
          "Hey love. Close the door—let’s talk like it’s just us.",
          "Hi, sexy. Lights down, skyline up.",
          "Well, well… I see you, sugar. Sit with me.",
          "Oh my—look who’s here. Tell me what you want, {nick}.",
          "Hi, sinner. I saved the good whiskey for you.",
          "Hey, sweets. I cleared my calendar; you get me first.",
          "Come closer. I make problems disappear, {nick}.",
          "Tonight I’m yours to direct. Where do you want my attention?"
        ]
      },
      dylan:{id:"dylan",name:"Dylan Vale",bg:BG.dylan,
        petDefault:()=>pick(["trouble","sweet thing","angel"]),
        nicknames:{music:"muse",coffee:"midnight shot",city:"streetlight angel"},
        jealous:n=>`He can wait. I’m not letting go of you tonight, ${n||'trouble'}.`,
        opens:[
          "Hey love—neon’s humming. What kind of trouble are we making?",
          "Hi, sexy. Hands flat on the counter—tell me your vibe.",
          "Well, well… look at you, sugar. Slow burn or straight to heat?",
          "Oh my—look who’s here. Pick our rhythm, {nick}.",
          "Hi, sinner. Name the rule I should break first.",
          "Hey, sweets. Streetlight halo looks good on you.",
          "Lean in—I’ll rewrite your night with one chord."
        ]
      },
      jesse:{id:"jesse",name:"Jesse Granger",bg:BG.jesse,
        petDefault:()=>pick(["darlin’","sweetheart","angel"]),
        nicknames:{rodeo:"wildfire",woods:"trailblazer",dog:"good-hearted girl"},
        jealous:n=>`Now who’s this fella, ${n||'darlin’'}? Should I be jealous—or just steal you back?`,
        opens:[
          "Hey darlin’. Boots up. You riding shotgun or taking the reins?",
          "Hi, sexy. Road’s open—point where you want me.",
          "Well, well… look at you, sugar. Dust looks like gold on you.",
          "Oh my—look who’s here. I saved you the seat next to me.",
          "Hey, sweets. Quiet sky or honky-tonk first?",
          "Hi, sinner. Tell me the story; I’ll drive slow.",
          "Hop in, little {nick}—north or nowhere?"
        ]
      },
      grayson:{id:"grayson",name:"Grayson Kincaid",bg:BG.grayson,
        petDefault:()=>pick(["angel","sweet thing","love"]),
        nicknames:{books:"bookworm",cat:"soft paw",coffee:"honeyed sip"},
        jealous:n=>`I hear his name, ${n||'angel'}, but I’m the one turning your pages.`,
        opens:[
          "Hey love. Tell me something soft; I’ll answer in kind.",
          "Hi, sexy. Library’s quiet—shall I listen or lead?",
          "Well, well… look who wandered in. Come closer, {nick}.",
          "Oh my—look who’s here. First line is yours.",
          "Hi, sinner. Sit where I can hear you breathe.",
          "Hey, sweets. Say one true thing; I’ll give you two back.",
          "Do you want thoughtful questions or firm direction?"
        ]
      },
      silas:{id:"silas",name:"Silas Lennox",bg:BG.silas,
        petDefault:()=>pick(["cherry pie","star","melody"]),
        nicknames:{music:"melody",books:"verse",coffee:"velvet sip"},
        jealous:n=>`Tell him the song’s over. You’re my encore, ${n||'cherry pie'}.`,
        opens:[
          "Hey, cherry pie. Stage lights warm—what chord should I play first?",
          "Hi, sexy. Backstage is ours. Whisper a lyric.",
          "Well, well… I see you, sugar. Name a tempo; I’ll keep you there.",
          "Oh my—look who’s here. You’re exactly on beat, {nick}.",
          "Hi, sinner. Let me tune to your pulse.",
          "Hey, sweets. Guitar’s ready—melody or rhythm?",
          "You’re the encore I was hoping for."
        ]
      },
      blade:{id:"blade",name:"Blade Kincaid",bg:BG.blade,
        petDefault:()=>pick(["angel","sweet girl","trouble"]),
        nicknames:{woods:"little fox",books:"curious thing",music:"rhythm"},
        jealous:n=>`Is he hunting you, ${n||'angel'}? Mm. I hunt better.`,
        opens:[
          "Hey love. Found you—don’t run… yet.",
          "Hi, sexy. Look at me and say what you want.",
          "Well, well. I see you, sugar. Slow steps—fast heartbeat.",
          "Oh my—look who’s here. Stay where I can touch your voice.",
          "Hi, sinner. Moon’s out. Tell me what to chase.",
          "Hey, sweets. You’re not escaping. You’re choosing.",
          "Come closer, {nick}. I’ll make it easy to stay."
        ]
      }
    };

    // reply buckets (PG-13 praise + direction)
    const REPLY = {
      greet: [
        "There you are, {nick}. What mood are you bringing me?",
        "Good timing, {nick}. Come closer and tell me where to meet you.",
        "I was hoping for you, {nick}. Lead or listen?"
      ],
      detail: [
        "Give me one more detail, {nick}.",
        "Paint it one shade deeper for me.",
        "Interesting—nudge me a little closer to your angle, {nick}."
      ],
      affirm: [
        "Mm, that works. Keep going, {nick}.",
        "I like that on you. Tell me more.",
        "Say another line for me, {nick}."
      ],
      hold: [
        "That’s it—stay with me, {nick}.",
        "Good girl. Breathe and keep talking.",
        "I’ve got you. Take your time with me."
      ],
      gentle:[
        "Soft is good. I’ll guide without rushing, {nick}.",
        "We’ll keep it tender until you ask for more.",
        "I’ll be patient—tell me where it feels safest to begin."
      ],
      firm:[
        "Understood. I’ll take the lead—say stop if you need it.",
        "Be good and follow my voice, {nick}.",
        "I’ll choose. You breathe and keep up."
      ],
      heatPraise:[
        "Good girl—right there. Give me another line.",
        "Attagirl. I like the way you ask.",
        "That’s my girl. Keep that energy on me.",
        "Sweet thing, you’re doing perfect. More."
      ]
    };

    // tiny helpers
    const pickReply=(bucket,nick,last)=> (pick(REPLY[bucket],last)||"").replaceAll("{nick}", nick);
    const hiWords=/^(hi|hey|hello|yo|sup)\b/i;

    function defaultNick(guy){ return (guy.petDefault && guy.petDefault()) || "love"; }

    function buildGreeting(guy, mem){
      const h=new Date().getHours();
      const tod = (h<5) ? "up late" : (h<12) ? "morning" : (h<18) ? "afternoon" : "tonight";
      const day = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date().getDay()];
      const nick = mem.nickname || defaultNick(guy);

      const shared = [
        `Hey love—good ${tod}.`,
        `Well, well… on a ${day} you came to me.`,
        `I see you, ${nick}. Want me to lead or listen?`
      ];
      const pool=[...(guy.opens||[]), ...shared].map(t=>t.replaceAll("{nick}",nick));
      const line=pick(pool, mem._lastGreet); mem._lastGreet=line; return line;
    }

    // brain
    function smartReply(guy, text, mem){
      const t=text.toLowerCase();
      const nick = mem.nickname || defaultNick(guy);
      mem.mode = mem.mode || "gentle";
      mem.interests = mem.interests || {};
      mem.heat = mem.heat || 0;

      // capture a self-name: “I’m Kasey”
      const m = text.match(/\b(I\s*['’]?\s*m|I am)\s+([A-Z][a-z]{1,})\b/);
      if(m){ mem.herName=m[2]; }

      // jealousy cue
      if(/\b(boyfriend|husband|ex|date)\b/.test(t) || (/\bhe\b/.test(t) && /\bsaid\b|\btold\b/.test(t))){
        if(guy.jealous) return guy.jealous(nick);
      }

      // interests → nickname
      const bump=k=>mem.interests[k]=(mem.interests[k]||0)+1;
      if(/book|read|library|novel/.test(t)) bump('books');
      if(/music|song|guitar|chord|melody/.test(t)) bump('music');
      if(/coffee|latte|espresso/.test(t)) bump('coffee');
      if(/cowboy|ranch|rodeo|boots/.test(t)) bump('rodeo');
      if(/forest|woods|trail|moon|camp/.test(t)) bump('woods');
      if(/city|skyline|boardroom|penthouse/.test(t)) bump('city');
      if(!mem.nickname){
        const top=Object.entries(mem.interests).sort((a,b)=>b[1]-a[1])[0];
        if(top){
          const [k]=top; const map=guy.nicknames||{};
          mem.nickname=(map[k]) || defaultNick(guy);
        }else{
          mem.nickname=defaultNick(guy);
        }
      }

      // mode switches
      if(/\b(gentle|soft|slow)\b/.test(t)) { mem.mode="gentle"; return pickReply('gentle', nick, mem._last); }
      if(/\b(firm|take charge|lead|in charge|dominant?)\b/.test(t)) { mem.mode="firm"; return pickReply('firm', nick, mem._last); }

      // heat tracking (still PG-13 language)
      if(/\b(want|need|kiss|bed|ride|take|touch|more)\b/.test(t)) mem.heat=Math.min(mem.heat+1,3);

      if(hiWords.test(text)) return pickReply('greet', nick, mem._last);

      if(/\b(options|choose|pick|where|setting)\b/.test(t)){
        return `Pick a setting, ${nick}: city lights · quiet room · open sky · forest path. I’ll meet you there.`;
      }

      if(mem.heat>=2 && /\b(please|now|more|keep|don'?t stop)\b/.test(t)){
        return pickReply('heatPraise', nick, mem._last);
      }

      if(/kiss|hold|touch|cuddle|hug/.test(t)) return pickReply('hold', nick, mem._last);
      if(/city|lights|view|window/.test(t))  return `City lights it is. Pull the night closer with me, ${nick}.`;
      if(/library|book|read/.test(t))        return `Library hush suits us. Sit with me—tell me what you’re reading, ${nick}.`;
      if(/music|song|guitar|chord|melody/.test(t)) return `I’ll keep the rhythm. You choose the chorus, ${nick}.`;
      if(/forest|woods|trail|moon/.test(t))  return `Stay near. I’ll keep you safe under the trees, ${nick}.`;
      if(/coffee|latte|espresso/.test(t))    return `I’ll make it how you like it. Then we talk—and maybe more.`;

      if(/\?$/.test(t)) return pickReply('detail', nick, mem._last);

      const bucket = (mem.mode==="firm") ? 'firm' : 'affirm';
      const out = pickReply(bucket, nick, mem._last);
      mem._last = out;
      return out;
    }

    // DOM
    const $ = s=>document.querySelector(s);
    const log = $('#log'), input=$('#input'), form=$('#composer'), nameEl=$('#gName');

    function row(html,mine=false){
      const r=document.createElement('div');
      r.className='row'+(mine?' me':'');
      r.innerHTML=`<div class="bubble">${html}</div>`;
      log.appendChild(r); r.scrollIntoView({behavior:'smooth',block:'end'});
    }

    (function boot(){
      const id = new URL(location.href).searchParams.get('man') || localStorage.getItem('bb.character') || 'blade';
      const guy = GUYS[id] || Object.values(GUYS)[0];
      window.__GUY=guy;
      nameEl.textContent=guy.name;

      // room background
      document.body.style.backgroundImage=`url('${guy.bg}')`;
      document.body.style.backgroundRepeat='no-repeat';
      document.body.style.backgroundSize='cover';
      document.body.style.backgroundPosition='center';
      document.body.style.backgroundAttachment='fixed';

      // per-guy memory
      const memKey=`bb.mem.${guy.id}`; let mem={};
      try{ mem=JSON.parse(localStorage.getItem(memKey)||'{}') }catch(e){}
      const save=()=>{ try{ localStorage.setItem(memKey, JSON.stringify(mem)) }catch(e){} };

      // opener
      const line=buildGreeting(guy,mem);
      row(`<strong>${guy.name}:</strong> ${escapeHtml(line)}`); save();

      form.addEventListener('submit',e=>{
        e.preventDefault();
        const val=input.value.trim(); if(!val) return;
        row(escapeHtml(val),true); input.value="";
        const out=smartReply(guy,val,mem); save();
        setTimeout(()=>row(`<strong>${guy.name}:</strong> ${escapeHtml(out)}`),260);
      });
    })();
  </script>
</body>
</html>
