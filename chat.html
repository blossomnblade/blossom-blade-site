<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Blossom &amp; Blade — Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />

  <!-- Inline fallback styles (robust on phone + desktop) -->
  <style>
    /* —— Layout: messages + portrait with pinned composer —— */
    :root { --composer-h: 84px; }

    html, body {
      height: 100%;
      margin: 0;
      background:#0d0f14;
      color:#cfd6e6;
      overflow: auto; /* allow page to scroll if needed */
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }

    .wrap {
      max-width: 1280px;
      margin: 0 auto;
      min-height: 100svh;            /* dynamic viewport for mobile */
      display: flex;
      flex-direction: column;
      padding: 12px;
      box-sizing: border-box;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 6px 4px 12px;
      font-weight: 600;
      color: #cfd6e6;
    }
    header .brand { opacity: .9; }
    header .title  { opacity: .85; }

    /* Trial / RED chip */
    .pill {
      position: fixed; top: 12px; right: 12px; z-index: 60;
      background:#0f1320; border:1px solid #1f2740; color:#cfd6e6;
      border-radius: 999px; padding: 6px 10px; font-size: 12px;
      display: inline-flex; align-items: center; gap: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
    }
    .dot { width: 6px; height: 6px; background:#ff6b6b; border-radius: 999px; display:inline-block; }

    /* two-column area */
    .row {
      flex: 1 1 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      align-items: start;
    }
    @media (min-width: 900px) {
      .row { grid-template-columns: minmax(0,1fr) 360px; }
    }

    /* messages column: its own scroller */
    ul#messages {
      list-style: none;
      margin: 0;
      padding: 0 0 16px 0;
      overflow: auto;
      max-height: calc(100svh - var(--composer-h) - 32px);
      scroll-behavior: smooth;
    }

    .bubble {
      display: inline-block;
      background:#0c1926;
      color:#cfd6e6;
      border-radius: 16px;
      padding: 10px 14px;
      max-width: 60ch;
      box-shadow: 0 8px 28px rgba(0,0,0,.30);
    }

    /* portrait column: also scrolls independently */
    .portrait-panel {
      overflow: auto;
      max-height: calc(100svh - var(--composer-h) - 32px);
      padding-right: 2px; /* keep scrollbar off edge */
    }
    .portrait-card {
      background:#0c1118;
      border-radius: 16px;
      padding: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    #portraitImg {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
      object-fit: cover;
    }
    #portraitLabel {
      margin-top: 8px;
      font-size: 12px;
      color:#9fb0cc;
      opacity: .9;
    }

    /* pinned composer */
    .composer {
      position: fixed; left: 0; right: 0; bottom: 0; z-index: 50;
      padding: 12px 16px max(12px, env(safe-area-inset-bottom, 0px));
      background: linear-gradient(180deg, rgba(8,10,14,0) 0%, rgba(8,10,14,0.88) 35%, rgba(8,10,14,0.98) 100%);
      backdrop-filter: blur(4px);
    }
    .composer form { display: flex; gap: 10px; max-width: 1100px; margin: 0 auto; }
    .composer input[type="text"] {
      flex: 1; min-width: 0;
      background:#0f1722; border:1px solid #223046; color:#d5def0;
      border-radius: 999px; padding: 14px 16px; outline: none;
    }
    .composer button {
      border: 0;
      border-radius: 999px;
      padding: 12px 20px;
      font-weight: 700;
      cursor: pointer;
      background:#ff6b93; color:#10141c;
      box-shadow: 0 10px 24px rgba(255,107,147,.35);
    }
    .composer button:disabled { opacity: .5; cursor: not-allowed; }

    /* make sure content can scroll behind the fixed composer if needed */
    body { padding-bottom: var(--composer-h); }

    /* small screens */
    @media (max-width: 900px) {
      .row { gap: 12px; }
      #portraitImg { max-height: 45vh; }
    }
  </style>

  <!-- Cache-busted external stylesheet (optional; keep if you already use one) -->
  <link rel="stylesheet" href="/styles/chat.css?v=2025-09-23" />
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Blossom &amp; Blade</div>
      <div class="title">— <span id="roomTitle">…</span></div>
      <!-- adults-only chip lives on landing; kept simple here -->
    </header>

    <!-- Trial / RED indicator the JS updates -->
    <div class="pill" id="slowBadge">
      <span class="dot"></span>
      <span id="trialText">Trial</span>
      <span>•</span>
      <span id="redText">RED</span>
      <span class="dot"></span>
    </div>

    <main class="row">
      <!-- Messages -->
      <section>
        <ul id="messages" aria-live="polite" aria-label="Messages"></ul>
      </section>

      <!-- Portrait -->
      <aside class="portrait-panel">
        <div class="portrait-card">
          <img id="portraitImg" alt="portrait" />
          <div id="portraitLabel"></div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Pinned composer -->
  <div class="composer">
    <form id="composer" autocomplete="off">
      <input id="chatInput" type="text" placeholder="Say something..." />
      <button id="sendBtn" type="submit">Send</button>
    </form>
  </div>

  <!-- Templates the script clones for messages -->
  <template id="tpl-user">
    <li><div class="bubble" style="background:#172233;color:#d7e3ff;"></div></li>
  </template>
  <template id="tpl-assistant">
    <li><div class="bubble"></div></li>
  </template>

  <!-- App scripts (order matters: helpers/brain before chat) -->
  <script src="/scripts/mod.js" defer></script>
  <script src="/scripts/brain.js" defer></script>
  <script src="/scripts/chat.js" defer></script>
</body>
</html>
