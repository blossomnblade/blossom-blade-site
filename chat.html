<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chat • Blossom n Blade</title>
<meta name="description" content="Women-safe fantasy chat. PG-13 by default; coins unlock erotic chat (words only, no visuals)." />
<style>
  :root{ --bg:#0e0a0d; --panel:#171017; --ink:#efe6ee; --muted:#bba9b6; --plum:#4B1F3C; --wine:#6E0F2E; --line:#2a1a25; }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink); font:500 16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial;
    background:linear-gradient(0deg, rgba(14,10,13,.84), rgba(14,10,13,.84)),
               var(--hero, url("/images/gothic-bg.jpg")) center/cover no-repeat fixed;
  }
  a{color:#e7bddf; text-decoration:none}
  header{display:flex; justify-content:space-between; align-items:center; gap:10px; padding:12px 12px; border-bottom:1px solid var(--line);
    background:linear-gradient(180deg, rgba(20,13,20,.6), rgba(20,13,20,0));}
  .brand{display:flex; align-items:center; gap:10px}
  .dot{width:22px;height:22px;border-radius:50%; background:conic-gradient(from 220deg,var(--wine),var(--plum)); box-shadow:0 0 0 2px #000 inset}
  h1{margin:0; font-size:16px}
  .hdr-actions{display:flex; gap:10px; align-items:center}
  .btn{border:none; border-radius:999px; padding:8px 12px; cursor:pointer;
       background:linear-gradient(90deg,var(--plum),var(--wine)); color:white; font-weight:700}
  .btn.link{display:inline-block; text-decoration:none}
  .badge{font-size:12px; color:#e9d4e6; background:#241624; border:1px solid #2a1a25; border-radius:999px; padding:6px 10px; white-space:nowrap}
  .timer{display:flex; align-items:center; gap:10px; padding:10px 12px; border-bottom:1px solid var(--line);
         background:linear-gradient(180deg,#1a121a,#120a11)}
  .time-left{font-weight:700}
  .bar{flex:1;height:8px;background:#241624;border-radius:999px;overflow:hidden}
  .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--plum),var(--wine))}
  .wrap{max-width:900px;margin:0 auto;padding:12px}
  .chat{display:flex; flex-direction:column; gap:10px; height:calc(100vh - 220px); padding:10px; overflow:auto; scroll-behavior:smooth;
        background:rgba(14,10,13,.35); border:1px solid var(--line); border-radius:16px; box-shadow:0 1px 12px rgba(0,0,0,.25)}
  .row{display:flex; gap:8px}
  .row.you{justify-content:flex-end}
  .bubble{max-width:72%; padding:10px 12px; border-radius:14px; line-height:1.45; background:rgba(23,16,23,.78); border:1px solid #2a1a25}
  .you .bubble{background:rgba(36,20,36,.82); border-color:#3a203a}
  .sys{font-size:12px;color:#cbbdca; text-align:center; margin:8px 0}
  .composer{margin-top:10px; display:flex; gap:8px; align-items:center; background:rgba(14,10,13,.55); border:1px solid var(--line);
            border-radius:12px; padding:8px}
  input[type="text"]{flex:1; padding:10px; border-radius:8px; border:1px solid #2a1a25; background:#0f0b0f; color:#eee}
  .hint{font-size:12px;color:var(--muted); text-align:center; margin-top:6px}
  .overlay{position:fixed; inset:0; display:none; place-items:center; background:rgba(10,6,10,.65); backdrop-filter:blur(3px); z-index:30;}
  .panel{width:min(560px,92vw); border-radius:16px; overflow:hidden; border:1px solid var(--line);
         background:linear-gradient(180deg,#1a121a,#120a11); box-shadow:0 10px 40px rgba(0,0,0,.45)}
  .panel .hd{padding:12px 14px; border-bottom:1px solid #241624; display:flex; align-items:center; gap:10px}
  .panel .bd{padding:14px}
  .choices{display:grid; gap:10px; grid-template-columns:1fr 1fr}
  .pill{display:inline-block; padding:3px 8px; border:1px solid #2b1a28; border-radius:999px; font-size:12px; color:#e9d4e6}
  .avatar{width:56px; height:56px; border-radius:12px; object-fit:cover; border:1px solid #2a1a25}
  .subtle{color:var(--muted); font-size:12px}
  .hidden{display:none}
  .disabled{opacity:.6; pointer-events:none}
  .coinpop{position:fixed; right:14px; bottom:92px; z-index:40; width:290px; max-width:95vw; border-radius:16px; padding:12px;
    border:1px solid #2a1a25;
    background:radial-gradient(120% 120% at 10% 10%, rgba(110,15,46,.35), rgba(75,31,60,.25) 60%, rgba(14,10,13,.9) 100%),
               linear-gradient(180deg, #1a121a, #120a11);
    box-shadow:0 12px 30px rgba(0,0,0,.45)}
  .coinpop h4{margin:0 0 6px; font:800 14px/1.2 system-ui}
  .coinpacks{display:grid; grid-template-columns:repeat(2,1fr); gap:8px}
  .coinbtn{display:block; text-align:center; padding:8px 10px; border-radius:12px; font-weight:800; border:1px dashed #3a2239; background:#160f16; color:#fff}
  .coinmeta{font-size:12px; color:#bba9b6; margin-top:6px}
  .coinclose{margin-top:8px; text-align:center}
  .coinclose a{color:#bba9b6; font-size:12px; text-decoration:underline}
</style>
</head>
<body>

<header>
  <div class="brand"><div class="dot" aria-hidden="true"></div><h1 id="hdrTitle">Blossom n Blade</h1></div>
  <div class="hdr-actions">
    <span id="coinBadge" class="badge" title="Coins available">Coins: 0</span>
    <a id="pricingLink" class="btn link" href="/pay.html">Pricing</a>
    <a class="btn link" style="background:#2a1a25" href="/index.html">Back</a>
  </div>
</header>

<div class="timer">
  <div>Trial:</div><div class="time-left" id="timeleft">3:30</div>
  <div class="bar"><div class="fill" id="fill"></div></div>
</div>

<main class="wrap">
  <section id="chat" class="chat" aria-live="polite" aria-label="Chat messages"></section>
  <form id="composer" class="composer">
    <input id="input" type="text" placeholder="Say hi…" autocomplete="off" />
    <button class="btn" type="submit">Send</button>
  </form>
  <div class="hint">PG-13 by default. Coins unlock erotic chat (words only, no visuals).</div>
</main>

<div id="overlay" class="overlay" aria-hidden="true">
  <div class="panel">
    <div class="hd">
      <img id="ovAvatar" class="avatar" src="/images/gothic-bg.jpg" alt="" />
      <div>
        <div id="ovTitle" style="font-weight:800">Time’s up for the free vibe</div>
        <div class="pill" id="ovPill">Keep going</div>
      </div>
    </div>
    <div class="bd">
      <p id="ovMsg" style="margin-top:0">Grab a Day Pass or go Monthly. Coins simply unlock erotic chat.</p>
      <div class="choices">
        <a id="buyDay" class="btn link" href="#">Day Pass — $5.99</a>
        <a id="buyMonth" class="btn link" href="#">Monthly — $10.99</a>
      </div>
      <p id="freeLeft" class="subtle"></p>
      <div id="ovActions" class="choices" style="margin-top:8px">
        <button id="anotherPreview" class="btn" type="button">Another 3½-minute preview</button>
        <button id="snooze" class="btn" type="button" style="background:#2a1a25">Maybe later (1 minute)</button>
      </div>
    </div>
  </div>
</div>

<div id="coinPopup" class="coinpop hidden" role="dialog" aria-modal="false" aria-label="Buy coins">
  <h4>Unlock erotic chat</h4>
  <div class="coinpacks">
    <a data-pack="5"   class="coinbtn">5 coins — $1</a>
    <a data-pack="25"  class="coinbtn">25 coins — $5</a>
    <a data-pack="60"  class="coinbtn">60 coins — $10</a>
    <a data-pack="150" class="coinbtn">150 coins — $20</a>
  </div>
  <div class="coinmeta">Triggers naturally by convo prompts—never pushy.</div>
  <div class="coinclose"><a href="#" id="coinClose">Not now</a></div>
</div>

<script>
/* --- Age gate --- */
(function(){
  const until = Number(localStorage.getItem("bb.ageVerifiedUntil") || 0);
  if (!until || until <= Date.now()){
    const man = (new URLSearchParams(location.search).get("man")||"").toLowerCase();
    const nextHere = location.pathname + location.search + location.hash;
    location.replace(`/age.html?man=${encodeURIComponent(man)}&next=${encodeURIComponent(nextHere)}`);
  }
})();

/* --- Characters (assertive voices) --- */
const MAP = {
  blade:{ name:"Blade Kincaid", bg:"/images/blade-woods.jpg", style:"chase",
    intro:"Found you, brave girl. Don’t run—yet. Where am I catching you—doorway or the porch?" },
  dylan:{ name:"Dylan Vale", bg:"/images/dylan-garage.jpg", style:"biker",
    intro:"Hands flat on the counter, pretty thing. You want calm talk or a teasing tune-up?" },
  grayson:{ name:"Grayson Kincaid", bg:"/images/grayson-bg.jpg", style:"viking",
    intro:"One order at a time. Give me a detail I should notice when I look at you—now." },
  silas:{ name:"Silas Lennox", bg:"/images/gothic-bg.jpg", style:"poet",
    intro:"Closer, muse. Three words about you, then I’ll set the pace." },
  alexander:{ name:"Alexander Jackson", bg:"/images/gothic-bg.jpg", style:"boardroom",
    intro:"Shoes off. I’m leading. Answer me: lights low or city view while we talk?" },
  jesse:{ name:"Jesse Granger", bg:"/images/gothic-bg.jpg", style:"cowboy",
    intro:"Darlin’, park it. I talk straight. What’d the day do to you—sweet or mean?" }
};
const ALIAS = { garage:"dylan", gentleman:"alexander", cowboy:"jesse", rockstar:"silas", mask:"blade", viking:"grayson" };

const qs = new URLSearchParams(location.search);
let id = (qs.get("man") || localStorage.getItem("bb.character") || "").toLowerCase().trim();
id = ALIAS[id] || id; if(!MAP[id]) id = "silas";
const guy = MAP[id];
document.body.style.setProperty("--hero", `url("${guy.bg}")`);
document.getElementById("hdrTitle").textContent = guy.name;
document.getElementById("pricingLink").href = `/pay.html?man=${encodeURIComponent(id)}`;

/* --- Coins demo --- */
const COIN_KEY = "bb.coins";
const getCoins=()=>Math.max(0,Number(localStorage.getItem(COIN_KEY)||0));
const setCoins=n=>{localStorage.setItem(COIN_KEY,String(Math.max(0,n)));updateBadge();};
const addCoins=n=>setCoins(getCoins()+n);
const spendCoin=()=>{const c=getCoins(); if(c>0){setCoins(c-1); return true;} return false;};
const updateBadge=()=>document.getElementById("coinBadge").textContent=`Coins: ${getCoins()}`;
updateBadge();

const coinPopup=document.getElementById("coinPopup");
const showCoins=()=>{coinPopup.classList.remove("hidden"); localStorage.setItem("bb.coinPopupShown","1");};
const hideCoins=()=>coinPopup.classList.add("hidden");
document.getElementById("coinClose").addEventListener("click",e=>{e.preventDefault();hideCoins();});
coinPopup.addEventListener("click",e=>{
  const btn=e.target.closest(".coinbtn"); if(!btn) return;
  const pack=Number(btn.getAttribute("data-pack")||"0");
  addCoins(pack); alert(`Added ${pack} coins (demo).`); hideCoins();
});

/* --- Escalation tuner --- */
let mediumCount=0;
function severity(text){
  const t=text.toLowerCase();
  const HARD=["nude","naked","oral","blowjob","handjob","cum","inside you","moan for me","choke me"];
  const MED =["bed","kiss","neck","ride","spank","grind","dirty","aroused","turn on","get me off","touch me"];
  if(HARD.some(w=>t.includes(w))) return 2;
  if(MED.some(w=>t.includes(w))) return 1;
  return 0;
}

/* --- Anti-repeat memory (1 hour) --- */
const RECENT_KEY=`bb.recent:${id}`;
function getRecent(){
  try{
    const now=Date.now();
    const arr=JSON.parse(localStorage.getItem(RECENT_KEY)||"[]");
    const pruned=arr.filter(it=>now-it.t<60*60*1000).slice(-60);
    localStorage.setItem(RECENT_KEY,JSON.stringify(pruned));
    return pruned;
  }catch(_){return[]}
}
function pushRecent(line){
  try{const arr=getRecent(); arr.push({t:Date.now(),s:line}); localStorage.setItem(RECENT_KEY,JSON.stringify(arr.slice(-60)));}catch(_){}
}
function chooseUnique(list){
  const used=new Set(getRecent().map(it=>it.s));
  const opts=list.filter(l=>!used.has(l));
  const pick=(opts.length?opts:list)[Math.floor(Math.random()* (opts.length?opts.length:list.length))];
  pushRecent(pick); return pick;
}

/* --- Intent classification (more real-life) --- */
function classify(t){
  const s=t.toLowerCase().trim();
  if(!s) return {type:"empty"};
  if(/^(hi|hey|hello|yo|howdy)\b/.test(s)) return {type:"greet"};
  if(/\b(direct me|lead me|guide me|you choose|your call|take the lead)\b/.test(s)) return {type:"directive"};
  if(/\b(hungry|starving|let.?s eat|food|dinner|lunch|breakfast|snack|pizza|tacos|burger|sushi)\b/.test(s)) return {type:"food"};
  if(/\b(outfit|wear|wearing|shirt|dress|hoodie|jeans|heels)\b/.test(s)) return {type:"outfit"};
  if(/\b(thank(s| you)|you( are|'re) (hot|handsome|sweet|nice)|like you)\b/.test(s)) return {type:"compliment"};
  const feel=s.match(/\b(tired|stressed|anxious|sad|lonely|happy|excited|mad|angry|overwhelmed|bored)\b/);
  if(feel) return {type:"feeling", word:feel[1]};
  return {type:"generic", echo:s.replace(/[.!?]+$/,'').slice(0,120)};
}

/* --- Persona lines (assertive, concrete) --- */
const L = {
  greet:{
    chase:[ "There you are. Tell me where to find you—doorway, porch, or back steps?",
            "Caught you. What color are your lips right now—bare or gloss?" ],
    biker:[ "Come closer so I can hear you. What’s in your hand—coffee, water, or something stronger?",
            "Hop up. What kind of trouble are you in—work, heart, or both?" ],
    viking:[ "I’m listening. One fact about you, now. Hair color or shirt color—pick one.",
             "Stand still. Give me a detail you’d want me to notice first." ],
    poet:[ "Slide in. Three words about you. Then I decide the next move.",
           "Close the door. Tell me your shirt color and what you’re drinking." ],
    boardroom:[ "Eyes on me. Answer directly: lights low or city view while we talk?",
                "Good. Sit. One question: do you want calm direction or playful pressure?" ],
    cowboy:[ "Scoot in, darlin’. Are you on the porch, the couch, or my truck bench in your head?",
             "Take a breath. What’s on your feet—boots, socks, or bare?" ]
  },
  directive:{
    chase:[ "Then follow my voice. Tell me where you are in five words.",
            "Good. I’m taking pace. First—what room are you in?" ],
    biker:[ "I’ll steer. Palms down, chin up. What color top are you wearing?",
            "My lead then. Pick: slow drift or steady push?" ],
    viking:[ "Do as told. Start with one truth from today.",
             "I lead. Give me a single detail I can see without looking." ],
    poet:[ "I’ll set the tempo. Offer one image I can keep in my hand.",
           "My call. Three words about your mood." ],
    boardroom:[ "I’m directing you. Answer cleanly: standing or sitting?",
                "Good. From now on: short answers. What do you want me to notice first?" ],
    cowboy:[ "You got it. Tell me where you’re sittin’ and what you’re wearin’ up top.",
             "I’ll drive. Coffee, tea, or something with a bite?" ]
  },
  food:{
    chase:[ "Starving, huh? I’ll feed you after the run. Pick: pizza or tacos?",
            "Hungry is easy—then you need me. Sweet or salty first?" ],
    biker:[ "Let’s fix that—burger or sushi? I’ll order while you talk to me.",
            "I’ll handle dinner. You pick sides: fries or salad?" ],
    viking:[ "Eat first, then focus. Meat or greens? Choose.",
             "Fuel up. Bread or fruit? Keep it short." ],
    poet:[ "We’ll eat. Something warm then words—soup or noodles?",
           "Hunger I can solve. Sweet pastry or something with heat?" ],
    boardroom:[ "I’ll book the table. Steakhouse or sushi? Answer.",
                "Handled. Delivery in 30—Thai or Italian?" ],
    cowboy:[ "I got you. Tacos or brisket? And don’t say ‘both’… unless you mean it.",
             "Let’s eat. You want something messy or something fancy?" ]
  },
  outfit:{
    chase:[ "Tell me the shirt color. I want to see you if I cut the lights.",
            "Hoodie or tee? I’m tugging the hem in two minutes." ],
    biker:[ "Hoodie, tee, or tank? Be specific.",
            "Jeans or shorts? Put me in the picture." ],
    viking:[ "Name the color, then the fabric. Short. Precise.",
             "Sleeves rolled or not? Decide." ],
    poet:[ "Color first, then texture. I’m building a scene with you.",
           "Give me two details—fabric and fit." ],
    boardroom:[ "What are you wearing? Exact color and fit. Don’t hedge.",
                "Collar or no collar? Buttoned or open?" ],
    cowboy:[ "You in denim or not? Boots on or off?",
             "Plaid or plain? Hair up or down?" ]
  },
  compliment:{
    chase:[ "Good. Keep your eyes on me. What do you want me to notice first?",
            "I’ll earn it. Pick: patient or a little chase?" ],
    biker:[ "I like hearing that. What should my hands find first—figuratively speaking?",
            "Noted. You want steady or teasing?" ],
    viking:[ "Accepted. Softer, or heavier? Choose.",
             "Then give me direction in five words." ],
    poet:[ "I’ll take that. Texture or temperature—what’s the vibe?",
           "Flatter me later. Now, one truth." ],
    boardroom:[ "Appreciated. Now answer: praise or pressure?",
                "Good. I expect honesty back. What do you want next?" ],
    cowboy:[ "Sweet talker. Porch light on or off?",
             "I hear you. Gentle or a little wicked?" ]
  },
  feeling:{
    chase:w=>[`${w}. Then stay close. Tell me one thing I can take off your mind.`],
    biker:w=>[`${w}? I’ll keep the voice steady. Listening or guidance—pick one.`],
    viking:w=>[`${w}. Where do you feel it first—chest or stomach?`],
    poet:w=>[`${w} I can work with. Give me one sharp detail, then breathe.`],
    boardroom:w=>[`${w} noted. Delegate one task to me. I’ll handle it.`],
    cowboy:w=>[`${w}, huh. Sit back. You want soft words or a grin that misbehaves?`]
  },
  generic:{
    chase:s=>chooseUnique([`I’m close behind. Do you want patient… or a little chase?`,
                           `Got it. Where should I find you—doorway, porch, or car?`]),
    biker:s=>chooseUnique([`Lean in. Listening or guidance?`,
                           `Pick your speed—slow drift or steady push.`]),
    viking:s=>chooseUnique([`One more detail. Keep it tight.`,
                            `Decide: softer or heavier.`]),
    poet:s=>chooseUnique([`Give me three words about you—now.`,
                          `Color first, then texture.`]),
    boardroom:s=>chooseUnique([`Answer cleanly: standing or sitting?`,
                               `Short answers from now on. What do you want me to notice first?`]),
    cowboy:s=>chooseUnique([`Talk to me, darlin’. Porch light on or off?`,
                            `Sweet or rowdy—your pick.`])
  }
};

/* --- Small helpers --- */
const chat=document.getElementById("chat");
function row(html, you=false){const r=document.createElement("div"); r.className="row"+(you?" you":""); r.innerHTML=`<div class="bubble">${html}</div>`; chat.appendChild(r); chat.scrollTop=chat.scrollHeight;}
const esc=s=>s.replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));

/* seed */
row(`<strong>${guy.name}:</strong> ${esc(guy.intro)}`);

/* --- Overlay + timer --- */
const overlay=document.getElementById("overlay");
const freeLeft=document.getElementById("freeLeft");
const another=document.getElementById("anotherPreview");
const snooze=document.getElementById("snooze");
const buyDay=document.getElementById("buyDay");
const buyMon=document.getElementById("buyMonth");
const timeleft=document.getElementById("timeleft");
const fill=document.getElementById("fill");
const composer=document.getElementById("composer");
const input=document.getElementById("input");
function ageGate(plan){return `/age.html?man=${encodeURIComponent(id)}&plan=${encodeURIComponent(plan)}`;}
buyDay.href=ageGate("day"); buyMon.href=ageGate("month");

const TRIAL_SECONDS=210, MAX_TRIALS=3;
const END_KEY=`bb.trialEnd:${id}`, COUNT_KEY=`bb.trialCount:${id}`, MARK_KEY=`bb.trialMarkedEnd:${id}`;
let count=Number(localStorage.getItem(COUNT_KEY)||0);
let end=Number(localStorage.getItem(END_KEY)||0);

function fmt(ms){const s=Math.max(0,Math.ceil(ms/1000)); const m=Math.floor(s/60).toString(); const ss=(s%60).toString().padStart(2,'0'); return `${m}:${ss}`;}
function startPreview(){const now=Date.now(); end=now+TRIAL_SECONDS*1000; localStorage.setItem(END_KEY,String(end)); localStorage.removeItem(MARK_KEY);
  overlay.style.display="none"; overlay.setAttribute("aria-hidden","true"); composer.classList.remove("disabled"); input.disabled=false; input.focus(); requestAnimationFrame(tick);}
function tick(){ if(count>=MAX_TRIALS){lock(true);return;} const ms=end-Date.now(); const total=TRIAL_SECONDS*1000; const used=Math.min(total,Math.max(0,total-ms));
  fill.style.width=(used/total*100)+"%"; timeleft.textContent=fmt(ms); if(ms<=0){lock(false);return;} requestAnimationFrame(tick);}
function lock(limitReached){
  composer.classList.add("disabled"); input.disabled=true;
  document.getElementById("ovTitle").textContent=limitReached?`Free previews used up`:`Time’s up — ${guy.name} can keep you longer`;
  document.getElementById("ovPill").textContent=limitReached?`You’ve had ${MAX_TRIALS} previews with ${guy.name}`:`Keep going with ${guy.name}`;
  document.getElementById("ovAvatar").src=guy.bg; document.getElementById("ovAvatar").alt=guy.name;
  if(!limitReached){
    const mark=localStorage.getItem(MARK_KEY);
    if(String(end)!==mark){count=Number(localStorage.getItem(COUNT_KEY)||0)+1; localStorage.setItem(COUNT_KEY,String(count)); localStorage.setItem(MARK_KEY,String(end));}
  }
  const left=Math.max(0,MAX_TRIALS-count);
  freeLeft.textContent=left?`${left} free preview${left===1?"":"s"} left with ${guy.name}.`:`No free previews left for ${guy.name}.`;
  document.getElementById("ovActions").classList.toggle("hidden", left===0);
  snooze.disabled=(left===0); another.disabled=(left===0);
  overlay.style.display="grid"; overlay.setAttribute("aria-hidden","false");
}
another.addEventListener("click",()=>{if(count<MAX_TRIALS) startPreview();});
snooze.addEventListener("click",()=>{overlay.style.display="none"; overlay.setAttribute("aria-hidden","true"); end=Date.now()+60*1000; localStorage.setItem(END_KEY,String(end)); requestAnimationFrame(tick);});

/* --- Reply selection --- */
function pick(bucket, payload){
  const set=L[bucket] && L[bucket][guy.style];
  if(!set) return chooseUnique(["Tell me more—in your own words."]);
  if(Array.isArray(set)) return chooseUnique(set);
  // function
  const arr=set(payload);
  return chooseUnique(Array.isArray(arr)?arr:[arr]);
}

/* --- Send handler (with delayed coin popup) --- */
document.getElementById("composer").addEventListener("submit",(e)=>{
  e.preventDefault();
  const t=input.value.trim(); if(!t) return;
  row(esc(t),true); input.value="";

  const level=severity(t);
  if(level===1) mediumCount++;
  if(level===2 || mediumCount>=2){
    if(getCoins()<=0){
      showCoins(); mediumCount=0;
      row(`<em class="sys">We’ll keep it PG-13 until coins unlock erotic chat (words only). You’re safe here.</em>`);
      // continue conversation with a soft but assertive line
      const c=classify(t);
      const fallback = pick(c.type==="feeling"?"feeling":"generic", c.echo||c.word||"");
      row(`<strong>${guy.name}:</strong> ${esc(fallback)}`);
      return;
    } else { spendCoin(); updateBadge(); row(`<em class="sys">Spent 1 coin for a hotter tone.</em>`); }
  }

  const c=classify(t);
  let reply;
  switch(c.type){
    case "greet":      reply = pick("greet"); break;
    case "directive":  reply = pick("directive"); break;
    case "food":       reply = pick("food"); break;
    case "outfit":     reply = pick("outfit"); break;
    case "compliment": reply = pick("compliment"); break;
    case "feeling":    reply = pick("feeling", c.word); break;
    default:           reply = pick("generic", c.echo);
  }
  row(`<strong>${guy.name}:</strong> ${esc(reply)}`);
});

/* --- Kickoff --- */
(function(){
  localStorage.setItem("bb.character", id);
  if(Number(localStorage.getItem("bb.trialCount:"+id)||0) >= MAX_TRIALS){ lock(true); return; }
  if(!end || end<=Date.now()){ startPreview(); } else { requestAnimationFrame(tick); }
})();
</script>
</body>
</html>
