<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blossom & Blade — Chat</title>
  <style>
    :root{
      --bg:#0e0f12; --panel:#14161b; --text:#e8eaf2; --muted:#9aa3b2; --accent:#ff6ea8;
      --edge:#20232b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }

    /* Header */
    .wrap{max-width:1100px; margin:auto; padding:28px 18px 40px}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px;
    }
    .title{font-size:clamp(22px, 3vw, 36px); font-weight:800; letter-spacing:.3px}
    .name-tag{color:var(--muted); font-weight:600}

    /* Layout */
    .board{
      position:relative; display:grid; grid-template-columns:1fr min(220px, 26%); gap:18px;
      min-height:60vh; background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);
      border:1px solid var(--edge); border-radius:14px; padding:12px;
    }

    /* Chat surface (placeholder) */
    .chat-surface{
      border-radius:12px; background:var(--panel);
      box-shadow: inset 0 0 0 1px #191c22, 0 10px 20px rgba(0,0,0,.25);
      min-height:56vh; display:flex; align-items:flex-end; justify-content:stretch;
      overflow:hidden;
    }
    .input-bar{display:flex; gap:8px; width:100%; padding:12px; background:#0f1116}
    .input{
      flex:1; padding:14px 16px; border-radius:10px; border:1px solid var(--edge);
      background:#12141a; color:var(--text); outline:none;
    }
    .btn{background:var(--accent); color:#101014; border:0; padding:0 16px; font-weight:700;
         border-radius:10px; cursor:pointer}

    /* Portrait */
    .card{
      position:relative; border-radius:12px; overflow:hidden; background:#0b0c10; border:1px solid var(--edge);
      min-height:280px; display:flex; align-items:center; justify-content:center;
    }
    .portrait{
      width:100%; height:auto; display:block; opacity:0; transition:opacity .25s ease;
      /* placeholder so we never see a white box */
      background:
        radial-gradient(120px 120px at 50% 30%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(#0b0c10,#0b0c10);
      aspect-ratio: 2 / 3;
      object-fit:cover;
    }
    .portrait.ready{opacity:1}
    .small-note{position:absolute; bottom:8px; right:10px; font-size:12px; color:var(--muted)}
    @media (max-width:820px){
      .board{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">Blossom &amp; Blade — Chat <span id="who" class="name-tag"></span></div>
      <div style="background:#1b1e26;border:1px solid var(--edge);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)">
        Adults 18+ only
      </div>
    </div>

    <section class="board">
      <!-- Chat UI shell -->
      <div class="chat-surface">
        <div class="input-bar">
          <input class="input" placeholder="Say hi..." />
          <button class="btn">Send</button>
        </div>
      </div>

      <!-- Portrait card -->
      <aside class="card">
        <img id="portrait" class="portrait" alt="" />
        <div class="small-note" id="imgHint"></div>
      </aside>
    </section>
  </div>

  <script>
    // -------- 1) Get character name from URL (?man=dylan) ----------
    const params = new URLSearchParams(location.search);
    const man = (params.get("man") || "dylan").toLowerCase();

    // Display name next to title
    const NAMELIST = { dylan:"Dylan", grayson:"Grayson", silas:"Silas", jesse:"Jesse", alexander:"Alexander", blade:"Blade" };
    const displayName = NAMELIST[man] || man.replace(/(^|\s)\S/g, m => m.toUpperCase());
    document.getElementById("who").textContent = "— " + displayName;

    // -------- 2) Build relative URLs (works on vercel + custom domain) ----------
    const rel = (file) => `/images/characters/${man}/${file}`;
    const sources = [
      `${man}-chat.webp`,        // primary
      `${man}-card-on.webp`,     // fallback #1
      `${man}-card-off.webp`     // fallback #2
    ].map(rel);

    // -------- 3) Try each image until one loads ----------
    const img = document.getElementById("portrait");
    const hint = document.getElementById("imgHint");
    let idx = 0;

    function tryNext() {
      if (idx >= sources.length) {
        hint.textContent = "image not found";
        img.alt = displayName;
        img.classList.add("ready"); // reveal placeholder
        return;
      }
      const url = sources[idx++];
      hint.textContent = url.split("/").pop();
      // load test without flashing white
      const test = new Image();
      test.onload = () => {
        img.src = url;
        img.classList.add("ready");
      };
      test.onerror = tryNext;
      test.src = url;
    }
    tryNext();
  </script>
</body>
</html>
